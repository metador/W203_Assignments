---
title: "HW week 12"
subtitle: "w203: Statistics for youtb_data Science"
author: "w203 teaching team"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# OLS Inference

The file videos.txt contains youtb_data scraped from Youtube.com.
```{r}
youtb_data = read.delim("./videos.txt",header=TRUE , sep="\t")
summary(youtb_data)
library(car)
library(lmtest)
library(sandwich)
library(stargazer)
```

```{r}
hist(youtb_data$views)
hist(log(youtb_data$views),breaks=50)
hist(log(youtb_data$length),breaks=50)
hist(youtb_data$rate)

```

1. Fit a linear model predicting the number of views (views), from the length of a video (length) and its average user rating (rate).
```{r}

model1 = lm(log(views)~rate + log(length) , data = youtb_data, na.action = na.omit)
summary(model1)
model2 = lm(log(views)~rate + length , data = youtb_data, na.action = na.omit)
```


2. Using diagnostic plots, background knowledge, and statistical tests, assess all 6 assumptions of the CLM.  When an assumption is violated, state what response you will take.
```{r}
plot(model1)
plot(model1, pch=".")
plot(model2)
plot(model2, pch=".")

## For No perfect multicollinearity
vif(model1)
vcovHC(model1)

## using the bptest are are looking for Homoskedasticity

bptest(model1)

hist(model2$residuals, breaks=50)

## Lets do check  for normaility of the residuals
hist(model1$residuals,breaks=50)

## the plot looks quite normal.
## Let us test it using the Shapiro-Wilk

sampler <-function(full_youtb_data){
  return (sample(full_youtb_data,5000))
}
s=rep(shapiro.test(sampler(model1$residuals))$p.value,1000)
s
s = shapiro.test(sampler(model1$residuals))
factors(s)
i=1
for (i in 1:10000){
  s[i]=shapiro.test(sampler(model1$residuals))$p.value
}

mean(s)
## Here we see that the p-value is 0.035 which is less than the threshold  so the residual is normally distributed statifying our 6 assumption

vcovHC(model1)
```


3. Generate a printout of your model coefficients, complete with standard errors that are valid given your diagnostics.  Comment on both the practical and statistical significance of your coefficients

.
```{r}
coeftest(model1, vcov = vcovHC)
```
